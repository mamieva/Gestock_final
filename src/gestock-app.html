<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">

<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<!-- Componentes propios -->
<link rel="import" href="./main-page.html">
<link rel="import" href="./config-page.html">
<link rel="import" href="./list-page.html">
<link rel="import" href="./login-page.html">
<link rel="import" href="./menu-app.html">
<dom-module id="gestock-app">
  <template>
    <style is="custom-style">
        iron-selector a {
          text-decoration: none;
          color: black;
        }
    </style>
    <!-- Enrutador -->
    <app-location route="{{route}}" use-hash-as-path></app-location>
    <app-route route="{{route}}" pattern="/:page" data="{{pageData}}" tail="{{subRoute}}">
    </app-route>
    <!-- Aplicacion -->
    <app-localstorage-document
            id = "session"
            key="session"
            data="{{session}}"
    </app-localstorage-document>

    <neon-animated-pages id="pages" attr-for-selected="name" selected="{{pageData.page}}">

      <login-page name="login" session="{{session}}"></login-page>

      <menu-app name="menu" session="{{session}}" route="{{subRoute}}"></menu-app>

    </neon-animated-pages>

  </template>

  <script>
    Polymer({
      is: 'gestock-app',

      properties:{
        session:{
          type: Object
        },
        isAuthenticated:{
          type: Boolean
        }

      },

      observers: [
        '_updateScroll(route)'
      ],
      listeners:{
        'login': 'loginUser'
      },
      ready: function(){
        console.log(this.pageData.page);
      },
      attached: function() {
        console.log(this.session);
        console.log(JSON.parse(window.localStorage.session).token);
        //
        if(this.session){
          this.set('route.path','/menu');
        }
        else{
          this.set('route.path','/login');
        }
        //console.log(this.session.isAuthenticated);
        // if(!this.session.token){
        //    if (!this.pageData.page) {
        //    this.set('route.path', '/login');
        //    //this.$.pages.selected = 0;
        //      }
        //    else {
        //    //this.set('route.path', '/' + this.pageData.page);
        //    //this.$.pages.selected = 0;
        //    }
        //   }
        //   else{
        //     //this.set('route.path', '/' + this.pageData.page);
        //     //this.$.pages.selected = 1;
        //   }
        
      },
      loginUser: function(event){
        //console.log('events disparado');
        //this.isAuthenticated = true;
        this.session = event.detail;
        window.location.reload();
        //console.log(this.session);

      },
      _updateScroll: function() {
        window.scroll(0, 0);
      }
    });
  </script>
</dom-module>
