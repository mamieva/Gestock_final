<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="./list-page-behavior.html">

<dom-module id="list-page">
    <template>
  <style>
  :host{
    display: block;
  }
  #sort {
    height: 300px;
  }
  </style>
  <app-route route="{{route}}"
                   pattern="/:key"
                   data="{{routeData}}"
                   id="routeManager">
  </app-route>
  <div id="divAjax"></div>
  <paper-input id="filter" label="Filter by first name"></paper-input>
  <div id="divList">
    <vaadin-grid id="itemsList" items={{items}}>
    </vaadin-grid>
  </div>
  </template>
    <script>
        Polymer({
            is: 'list-page',
            properties: {
                active: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                },
                page: {
                    type: 'String'
                },
                data:{
                  type: 'String'
                },
                url:{
                  type: 'String',
                  value: 'https://jsonplaceholder.typicode.com/'
                },
                route: {
                  type: Object,
                  notify: true
                }

            },
            behaviors: [AWSLBehaviors.ListVaadinBehavior],
            observers: [
                '_routeChanged(route.path)',
                '_viewChanged(data)',
                '_fastsearchChanged(fastsearch)'
            ],
            _routeChanged: function(newRoute) {
              console.log(this.route);
                if (newRoute.path == "") {
                    this.set('routeData.key', '');
                    if (this.key !== undefined && this.key != "") {
                        this._viewChanged('');
                    }
                }
            },
            _viewChanged: function(data) {
                //console.log("cambio"+ this.url + data);
                this.ajaxlist.url = this.url + data;
                this.$.divAjax.appendChild(this.ajaxlist);
                this.ajaxlist.generateRequest();
            },
            getItemsList: function() {
                // console.log(this.$.itemsList);
                return this.$.itemsList;
            },
            getFilter: function() {
                return this.$.filter;
            },
            getListToolbar: function() {
                return this.$.tool;
            },
            reset: function() {
                if (this.$.pages.selected != 0) {
                    this._onClose();
                    this.refresh();
                }
            },
            _onNew: function() {
                this.key = "0";
                this.set('route.path', '/' + this.key);
            },
            _onClose: function() {
                this.$.pages.entryAnimation = "slide-from-left-animation";
                this.$.pages.exitAnimation = "slide-right-animation";
                this.set('route.path', '');
                this.set('routeData.key', '');
                this.$.pages.selected = 0;
            },
            _editorSetTitle: function(event) {
                if (this.$.pages.selected == 0) {
                    event.stopPropagation();
                }
            },
            customizeItemsList: function() {
                this.parentElement.customizeItemsList(this.$.itemsList);
            },
            _selectedItemChanged: function(event){
              console.log(this.items[this.selection.selected()[0]].id);
              var key = this.items[this.selection.selected()[0]].id;
              //window.location.href = '/users/hla';
              var reallythis = this.reallythis;
              reallythis.set('route.path', '/'+ key);
              //console.log(reallythis.route);
            }
        });
    </script>
</dom-module>
